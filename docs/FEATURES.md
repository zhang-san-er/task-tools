# 功能说明文档

## 核心功能

### 1. 任务管理

#### 任务类型
- **主线任务** (`main`) - 普通任务，完成获得积分
- **付费挑战** (`demon`) - 需要支付入场积分，失败扣除入场积分

#### 任务属性
- 任务名称
- 奖励积分
- 入场积分（仅付费挑战）
- 是否可重复
- 截止日期（可选）

#### 任务状态
- `isClaimed` - 是否已领取
- `isStarted` - 是否已开始（付费挑战支付后）
- `isCompleted` - 是否已完成

#### 操作流程
1. 创建任务 → 设置类型、积分、截止日期等
2. 领取任务 → 免费任务直接领取，付费任务需支付入场积分
3. 完成任务 → 点击完成按钮，获得积分奖励
4. 取消领取 → 取消已领取的任务

### 2. 积分系统

#### 积分获取
- 完成任务获得积分
- 积分数量 = 任务设置的奖励积分

#### 积分消耗
- 付费挑战入场费
- 兑换奖励商品

#### 积分显示
- 总积分：累计获得的所有积分
- 当前积分：可用于兑换的积分

### 3. 等级系统

#### 等级计算
- 经验值 = 累计获得的积分
- 等级 = `Math.floor(experience / 100) + 1`
- 每 100 经验值升一级

#### 等级显示
- 用户档案显示当前等级
- 等级进度条显示升级进度

### 4. 奖励商城

#### 奖励类型
- **虚拟奖励** - 如休息日、成就徽章
- **实物奖励** - 如奶茶、电影票、美食

#### 商城管理
- 编辑模式：添加、编辑、删除、上架/下架商品
- 兑换功能：使用积分兑换奖励
- 兑换记录：记录所有兑换历史

#### 默认奖励
- 休息日（50积分）
- 小奖励（100积分）
- 电影票（200积分）
- 美食大餐（300积分）
- 购物券（500积分）
- 成就徽章（1000积分）

### 5. 任务记录

#### 记录内容
- 任务名称
- 获得积分
- 支出积分（付费挑战）
- 完成时间
- 任务类型

#### 记录显示
- 按时间倒序排列
- 显示净收益（付费挑战）
- 显示任务类型标签

### 6. 数据管理

#### 数据导出
- 导出所有应用数据为 JSON 文件
- 文件名格式：`task-platform-backup-YYYY-MM-DD.json`

#### 数据导入
- 从 JSON 文件恢复数据
- 导入后自动刷新页面

#### 数据清除
- 清除所有本地数据
- 需要二次确认
- 操作不可恢复

## 页面结构

### 主页面（Home）
- 用户档案卡片
- 任务列表
- 任务筛选（全部/进行中/主线任务/付费挑战）
- 新建任务按钮

### 积分页面（Points）
- 积分显示
- 积分商城入口
- 完成记录列表

### 商城页面（Shop）
- 积分显示
- 奖励商品列表
- 编辑模式切换

### 设置页面（Settings）
- 数据导出
- 数据导入
- 数据清除

## 交互设计

### 弹窗规范
- 所有弹窗使用统一布局
- 标题固定，内容可滚动，按钮固定底部
- 蒙层背景：`bg-black/50 backdrop-blur-sm`

### 按钮样式
- 主要操作：渐变背景（紫色到粉色）
- 次要操作：灰色背景
- 危险操作：红色背景
- 悬停效果：阴影增强
- 点击反馈：`active:scale-95`

### 卡片样式
- 圆角：`rounded-3xl`
- 阴影：`card-shadow` / `card-shadow-lg`
- 边框：`border border-white/60`
- 悬停效果：`hover:shadow-lg`

## 数据存储

### LocalStorage Keys
- `habit-game-tasks` - 任务数据
- `habit-game-user` - 用户数据
- `habit-game-rewards` - 奖励数据
- `habit-game-task-records` - 任务记录

### 数据迁移
- `userStore` 支持从 `health` 迁移到 `experience`
- `taskStore` 确保所有任务都有 `isRepeatable` 和 `isClaimed` 字段

## PWA 支持

- 支持离线使用
- 可安装到主屏幕
- Service Worker 缓存策略
- Manifest 配置完整

